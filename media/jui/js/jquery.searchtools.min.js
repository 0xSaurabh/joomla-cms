!function(a,b,c,d){function g(b,c){this.element=b,this.options=a.extend({},f,c),this._defaults=f,this.theForm=a(this.options.formSelector),this.filterButton=a(this.options.formSelector+" "+this.options.filterBtnSelector),this.filterContainer=a(this.options.formSelector+" "+this.options.filterContainerSelector),this.filtersHidden=this.options.filtersHidden,this.listButton=a(this.options.formSelector+" "+this.options.listBtnSelector),this.listContainer=a(this.options.formSelector+" "+this.options.listContainerSelector),this.listHidden=this.options.listHidden,this.mainContainer=a(this.options.mainContainerSelector),this.searchButton=a(this.options.formSelector+" "+this.options.searchBtnSelector),this.searchField=a(this.options.formSelector+" "+this.options.searchFieldSelector),this.searchString=null,this.clearButton=a(this.options.clearBtnSelector),this.orderCols=a(this.options.formSelector+" "+this.options.orderColumnSelector),this.orderField=a(this.options.formSelector+" "+this.options.orderFieldSelector),this.limitField=a(this.options.formSelector+" "+this.options.limitFieldSelector),this.activeColumn=null,this.activeDirection=this.options.activeDirection,this.activeOrder=this.options.activeOrder,this.activeLimit=null,this.chosenSupport=this.options.chosenSupport,this.clearListOptions=this.options.clearListOptions,this._name=e,this.init()}var e="searchtools",f={formSelector:".js-stools-form",searchFieldSelector:".js-stools-field-search",clearBtnSelector:".js-stools-btn-clear",mainContainerSelector:".js-stools",searchBtnSelector:".js-stools-btn-search",filterBtnSelector:".js-stools-btn-filter",filterContainerSelector:".js-stools-container-filters",filtersHidden:!0,listBtnSelector:".js-stools-btn-list",listContainerSelector:".js-stools-container-list",listHidden:!1,orderColumnSelector:".js-stools-column-order",orderBtnSelector:".js-stools-btn-order",orderFieldSelector:".js-stools-field-order",orderFieldName:"list[fullordering]",limitFieldSelector:".js-stools-field-limit",defaultLimit:20,activeOrder:null,activeDirection:"ASC",chosenSupport:!0,clearListOptions:!1};g.prototype={init:function(){var b=this;c.addEventListener||this.searchField.val()===this.searchField.attr("placeholder")&&this.searchField.val(""),this.searchString=this.searchField.val(),this.filtersHidden?this.hideFilters():this.showFilters(),this.listHidden?this.hideList():this.showList(),b.filterButton.click(function(a){b.toggleFilters(),a.stopPropagation(),a.preventDefault()}),b.listButton.click(function(a){b.toggleList(),a.stopPropagation(),a.preventDefault()}),b.getFilterFields().each(function(c,d){b.checkFilter(d),a(d).change(function(){b.checkFilter(d)})}),b.clearButton.click(function(a){b.clear()}),this.createOrderField(),this.orderCols.click(function(){var c=a(this).attr("data-order"),d=a(this).attr("data-direction"),e=c+" "+d;c.length&&(b.activeColumn=c,e!==b.activeOrder?(b.activeDirection=d,b.activeOrder=e,b.updateFieldValue(b.orderField,e)):b.toggleDirection(),b.theForm.submit())})},checkFilter:function(b){var c=this,d=a(b).find("option:selected");""!==d.val()?c.activeFilter(b):c.deactiveFilter(b)},clear:function(){var b=this;b.getFilterFields().each(function(c,d){a(d).val(""),b.checkFilter(d),b.chosenSupport&&a(d).trigger("liszt:updated")}),b.clearListOptions&&(b.getListFields().each(function(c,d){a(d).val(""),b.checkFilter(d),b.chosenSupport&&a(d).trigger("liszt:updated")}),a("#list_limit").val(b.options.defaultLimit),b.chosenSupport&&a("#list_limit").trigger("liszt:updated")),b.searchField.val(""),b.theForm.submit()},activeFilter:function(b){a(b).addClass("active");var d="#"+a(b).attr("id")+"_chzn";a(d).addClass("active")},deactiveFilter:function(b){a(b).removeClass("active");var d="#"+a(b).attr("id")+"_chzn";a(d).removeClass("active")},getFilterFields:function(){return this.filterContainer.find("select,input")},getListFields:function(){return this.listContainer.find("select")},hideContainer:function(b){a(b).hide("fast"),a(b).removeClass("shown")},showContainer:function(b){a(b).show("fast"),a(b).addClass("shown")},toggleContainer:function(b){a(b).hasClass("shown")?this.hideContainer(b):this.showContainer(b)},hideList:function(){this.hideContainer(this.listContainer),this.listButton.removeClass("btn-primary"),this.listButton.addClass("btn-secondary")},showList:function(){this.showContainer(this.listContainer),this.listButton.addClass("btn-primary"),this.listButton.removeClass("btn-secondary")},toggleList:function(){this.toggleContainer(this.listContainer),this.listContainer.hasClass("shown")?(this.listButton.addClass("btn-primary"),this.listButton.removeClass("btn-secondary")):(this.listButton.addClass("btn-primary"),this.listButton.removeClass("btn-secondary"))},hideFilters:function(){this.hideContainer(this.filterContainer),this.filterButton.removeClass("btn-primary"),this.filterButton.addClass("btn-secondary")},showFilters:function(){this.showContainer(this.filterContainer),this.filterButton.addClass("btn-primary"),this.filterButton.removeClass("btn-secondary")},toggleFilters:function(){this.toggleContainer(this.filterContainer),this.filterContainer.hasClass("shown")?(this.filterButton.addClass("btn-primary"),this.filterButton.removeClass("btn-secondary")):(this.filterButton.addClass("btn-secondary"),this.filterButton.removeClass("btn-primary"))},toggleDirection:function(){var a=this,b="ASC";"ASC"==a.activeDirection.toUpperCase()&&(b="DESC"),a.activeDirection=b,a.activeOrder=a.activeColumn+" "+b,a.updateFieldValue(a.orderField,a.activeOrder)},createOrderField:function(){var b=this;this.orderField.length||(this.orderField=a("<input>").attr({type:"hidden",id:"js-stools-field-order",class:"js-stools-field-order",name:b.options.orderFieldName,value:b.activeOrder+" "+this.activeDirection}),this.orderField.appendTo(this.theForm)),this.orderField.is("select")&&(this.orderCols.each(function(){var c=a(this).attr("data-order"),d=a(this).attr("data-name"),e=a(this).attr("data-direction");if(c.length){c=c+" "+e;var f=b.findOption(b.orderField,c);if(!f.length){var f=a("<option>");f.text(d).val(c),a(this).hasClass("active")&&f.attr("selected","selected"),b.orderField.append(f)}}}),this.orderField.trigger("liszt:updated")),this.activeOrder=this.orderField.val()},updateFieldValue:function(b,c){var d=this,e=b.attr("type");if("hidden"===e||"text"===e)b.attr("value",c);else if(b.is("select")){var f=b.find("option").filter(function(){return a(this).val()==c});if(f.length)f.attr("selected","selected");else{var g=a("<option>");g.text(c).val(c),g.attr("selected","selected"),b.append(g)}d.chosenSupport&&b.trigger("liszt:updated")}},findOption:function(b,c){return b.find("option").filter(function(){return a(this).val()==c})}},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new g(this,b))})}}(jQuery,window,document);