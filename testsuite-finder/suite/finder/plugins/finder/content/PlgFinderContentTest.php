<?php
/**
 * @package	    Joomla.UnitTest
 * @subpackage  com_finder
 *
 * @copyright   Copyright (C) 2005 - 2011 Open Source Matters, Inc. All rights reserved.
 * @license	    GNU General Public License version 2 or later; see LICENSE
 */

require_once JPATH_PLUGINS . '/finder/content/content.php';
include_once __DIR__ . '/stubs/PlgFinderContentInspector.php';

/**
 * Test class for PlgFinderContent.
 * Generated by PHPUnit on 2011-10-21 at 02:52:22.
 */
class PlgFinderContentTest extends JoomlaDatabaseTestCase
{
	/**
	 * @var PlgFinderContentInspector
	 */
	protected $inspector;

	/**
	 * Sets up the fixture, for example, opens a network connection.
	 * This method is called before a test is executed.
	 */
	protected function setUp()
	{
		parent::setUp();

		// Get a new FinderIndexerAdapterInspector instance.
		$dispatcher = JDispatcher::getInstance();
		$config = array(
			'type' => 'finder',
			'name' => 'content',
			'params' => '{}'
		);
		$this->inspector = new PlgFinderContentInspector($dispatcher, $config);
	}

	/**
	 * Tears down the fixture, for example, closes a network connection.
	 * This method is called after a test is executed.
	 */
	protected function tearDown()
	{
		parent::tearDown();
	}

	/**
	 * Gets the data set to be loaded into the database during setup
	 *
	 * @return  xml dataset
	 *
	 * @since   2.5
	 */
	protected function getDataSet()
	{
		return $this->createXMLDataSet(JPATH_TESTS . '/includes/testfiles/FinderDBTest.xml');
	}

	/**
	 * Test the onContentChangeState method.
	 *
	 * @return  void
	 *
	 * @since   2.5
	 */
	public function testOnContentChangeState()
	{
		$this->assertThat(
			$this->inspector->onContentChangeState('com_content.article', array('0' => 1), '0'),
			$this->isNull(),
			'Successfully set the indexed state of article ID 1 to 0'
		);

		$this->assertThat(
			$this->inspector->onContentChangeState('com_categories.category', array('0' => 21), '0'),
			$this->isNull(),
			'Do not process a category'
		);
	}

	/**
	 * Test the getListQuery method.
	 *
	 * @return  void
	 *
	 * @since   2.5
	 */
	public function testGetListQuery()
	{
		$this->assertInstanceOf(
			'JDatabaseQuery',
			$this->inspector->getListQuery(null),
			'The list query is an instance of JDatabaseQuery'
		);
	}

	/**
	 * Test the setup method.
	 *
	 * @return  void
	 *
	 * @since   2.5
	 */
	public function testSetup()
	{
		$this->assertThat(
			$this->inspector->setup(),
			$this->isTrue(),
			'The setup is successful'
		);
	}
}
